<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered GitHub Monitor & Social Media Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin: 5px 5px 5px 0;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        button.secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }

        button.success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        button.danger {
            background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%);
        }

        .status {
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 500;
        }

        .status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background-color: #cce7ff;
            color: #004085;
            border: 1px solid #b8daff;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 1024px) {
            .grid-3 {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            .grid, .grid-3 {
                grid-template-columns: 1fr;
            }
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e9ecef;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border: none;
            background: none;
            color: #6c757d;
            font-weight: 600;
            margin: 0;
            border-radius: 0;
            transition: color 0.3s ease;
        }

        .tab.active {
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .monitoring-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #dc3545;
        }

        .status-indicator.active {
            background-color: #28a745;
        }

        .log-container {
            max-height: 300px;
            overflow-y: auto;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }

        .log-entry.info {
            color: #0066cc;
        }

        .log-entry.success {
            color: #28a745;
        }

        .log-entry.error {
            color: #dc3545;
        }

        .social-preview {
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 15px;
            margin: 10px 0;
            background: white;
            position: relative;
        }

        .social-preview.twitter {
            border-color: #1da1f2;
            border-left: 4px solid #1da1f2;
        }

        .social-preview.linkedin {
            border-color: #0077b5;
            border-left: 4px solid #0077b5;
        }

        .social-preview.instagram {
            border: 2px solid;
            border-image: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888) 1;
        }

        .social-preview.facebook {
            border-color: #4267B2;
            border-left: 4px solid #4267B2;
        }

        .social-preview.tiktok {
            border-color: #fe2c55;
            border-left: 4px solid #fe2c55;
        }

        .character-count {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
        }

        .character-count.warning {
            color: #ffc107;
        }

        .character-count.danger {
            color: #dc3545;
        }

        .ai-model-config {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .model-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .model-status.connected {
            background-color: #d4edda;
            color: #155724;
        }

        .model-status.disconnected {
            background-color: #f8d7da;
            color: #721c24;
        }

        .content-editor {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .editor-panel {
            flex: 1;
        }

        .preview-panel {
            flex: 1;
        }

        .suggestion-box {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .hashtag-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .hashtag {
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .hashtag:hover {
            background: #5a67d8;
        }

        .emoji-picker {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin: 10px 0;
        }

        .emoji {
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: background 0.3s ease;
        }

        .emoji:hover {
            background: #f0f0f0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ AI-Powered Social Media Generator</h1>
            <p>Multi-AI GitHub monitoring with platform-specific content creation</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('monitor')">üì° Monitor</button>
            <button class="tab" onclick="showTab('create')">‚úçÔ∏è Create</button>
            <button class="tab" onclick="showTab('ai-config')">üß† AI Models</button>
            <button class="tab" onclick="showTab('templates')">üìù Templates</button>
        </div>

        <!-- Monitor Tab -->
        <div id="monitor" class="tab-content active">
            <div class="card">
                <h2>‚öôÔ∏è Repository Configuration</h2>
                <div class="grid">
                    <div>
                        <div class="form-group">
                            <label for="githubToken">GitHub Personal Access Token:</label>
                            <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxx">
                        </div>
                        <div class="form-group">
                            <label for="repoUrl">Repository URL:</label>
                            <input type="url" id="repoUrl" placeholder="https://github.com/username/repo">
                        </div>
                        <div class="form-group">
                            <label for="checkInterval">Check Interval (minutes):</label>
                            <input type="number" id="checkInterval" value="5" min="1">
                        </div>
                    </div>
                    <div>
                        <div class="form-group">
                            <label for="autoGenerate">Auto-generate posts on changes:</label>
                            <input type="checkbox" id="autoGenerate" checked>
                        </div>
                        <div class="form-group">
                            <label for="selectedPlatforms">Target Platforms:</label>
                            <select id="selectedPlatforms" multiple>
                                <option value="twitter" selected>Twitter/X</option>
                                <option value="linkedin" selected>LinkedIn</option>
                                <option value="instagram">Instagram</option>
                                <option value="facebook">Facebook</option>
                                <option value="tiktok">TikTok</option>
                                <option value="blog">Blog Post</option>
                            </select>
                        </div>
                    </div>
                </div>
                <button onclick="startMonitoring()" class="success">Start Monitoring</button>
                <button onclick="stopMonitoring()" class="danger">Stop Monitoring</button>
                <button onclick="checkNow()" class="secondary">Check Now</button>
            </div>

            <div class="card">
                <div class="monitoring-status">
                    <div class="status-indicator" id="statusIndicator"></div>
                    <h3>Monitoring Status: <span id="statusText">Stopped</span></h3>
                </div>
                <div id="statusMessage"></div>
            </div>

            <div class="grid">
                <div class="card">
                    <h3>üìã Activity Log</h3>
                    <div class="log-container" id="logContainer">
                        <div class="log-entry info">System initialized. Ready to start monitoring.</div>
                    </div>
                </div>

                <div class="card">
                    <h3>üìä Repository Info</h3>
                    <div id="repoInfo">
                        <p>No repository configured</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Create Tab -->
        <div id="create" class="tab-content">
            <div class="card">
                <h2>‚úçÔ∏è Content Creation</h2>
                
                <div class="form-group">
                    <label for="creationMode">Creation Mode:</label>
                    <select id="creationMode" onchange="toggleCreationMode()">
                        <option value="generate">AI Generate from Repo</option>
                        <option value="rephrase">AI Rephrase My Text</option>
                        <option value="manual">Write Manually</option>
                    </select>
                </div>

                <div id="generateMode">
                    <div class="form-group">
                        <label for="generatePrompt">Custom Generation Prompt:</label>
                        <textarea id="generatePrompt" rows="3" placeholder="Tell the AI how to generate content about your repository..."></textarea>
                    </div>
                </div>

                <div id="rephraseMode" style="display: none;">
                    <div class="form-group">
                        <label for="originalText">Your Original Text:</label>
                        <textarea id="originalText" rows="4" placeholder="Write your original content here, and AI will rephrase it for different platforms..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="rephraseInstructions">Rephrase Instructions:</label>
                        <textarea id="rephraseInstructions" rows="2" placeholder="Make it more professional, casual, technical, etc..."></textarea>
                    </div>
                </div>

                <div id="manualMode" style="display: none;">
                    <div class="form-group">
                        <label for="manualContent">Manual Content:</label>
                        <textarea id="manualContent" rows="6" placeholder="Write your content manually..."></textarea>
                    </div>
                </div>

                <div class="form-group">
                    <label for="targetPlatform">Target Platform:</label>
                    <select id="targetPlatform" onchange="updatePlatformSettings()">
                        <option value="twitter">Twitter/X (280 chars)</option>
                        <option value="linkedin">LinkedIn (3000 chars)</option>
                        <option value="instagram">Instagram (2200 chars)</option>
                        <option value="facebook">Facebook (63,206 chars)</option>
                        <option value="tiktok">TikTok (4000 chars)</option>
                        <option value="blog">Blog Post (unlimited)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="contentTone">Tone & Style:</label>
                    <select id="contentTone">
                        <option value="professional">Professional</option>
                        <option value="casual">Casual & Friendly</option>
                        <option value="technical">Technical</option>
                        <option value="exciting">Exciting & Energetic</option>
                        <option value="humorous">Humorous</option>
                        <option value="educational">Educational</option>
                        <option value="promotional">Promotional</option>
                    </select>
                </div>

                <button onclick="generateContent()" class="success">üöÄ Generate Content</button>
            </div>

            <div class="card" id="contentPreviewCard" style="display: none;">
                <h3>üì± Platform Preview</h3>
                <div id="contentPreview"></div>
                
                <div class="content-editor">
                    <div class="editor-panel">
                        <label for="contentEditor">Edit Content:</label>
                        <textarea id="contentEditor" rows="8" onkeyup="updatePreview()"></textarea>
                        <div id="characterCount" class="character-count"></div>
                        
                        <div class="suggestion-box">
                            <strong>üí° AI Suggestions:</strong>
                            <div id="aiSuggestions"></div>
                        </div>
                        
                        <div class="hashtag-suggestions" id="hashtagSuggestions"></div>
                        
                        <div class="emoji-picker">
                            <span class="emoji" onclick="insertEmoji('üöÄ')">üöÄ</span>
                            <span class="emoji" onclick="insertEmoji('üíª')">üíª</span>
                            <span class="emoji" onclick="insertEmoji('üî•')">üî•</span>
                            <span class="emoji" onclick="insertEmoji('‚≠ê')">‚≠ê</span>
                            <span class="emoji" onclick="insertEmoji('üéâ')">üéâ</span>
                            <span class="emoji" onclick="insertEmoji('üí°')">üí°</span>
                            <span class="emoji" onclick="insertEmoji('üåü')">üåü</span>
                            <span class="emoji" onclick="insertEmoji('üë®‚Äçüíª')">üë®‚Äçüíª</span>
                        </div>
                    </div>
                    
                    <div class="preview-panel">
                        <label>Platform Preview:</label>
                        <div id="platformPreview" class="social-preview"></div>
                    </div>
                </div>

                <button onclick="copyContent()" class="secondary">üìã Copy</button>
                <button onclick="downloadContent()" class="secondary">üíæ Download</button>
                <button onclick="schedulePost()" class="success">‚è∞ Schedule</button>
                <button onclick="refineContent()" class="secondary">‚ú® AI Refine</button>
            </div>
        </div>

        <!-- AI Config Tab -->
        <div id="ai-config" class="tab-content">
            <div class="card">
                <h2>üß† AI Model Configuration</h2>
                
                <div class="grid-3">
                    <div class="ai-model-config">
                        <h4>Google Gemini <span id="geminiStatus" class="model-status disconnected">Disconnected</span></h4>
                        <div class="form-group">
                            <input type="password" id="geminiApiKey" placeholder="Gemini API Key" onchange="validateApiKey('gemini')">
                        </div>
                        <small>Best for: Creative content, detailed explanations</small>
                    </div>

                    <div class="ai-model-config">
                        <h4>OpenAI GPT <span id="openaiStatus" class="model-status disconnected">Disconnected</span></h4>
                        <div class="form-group">
                            <input type="password" id="openaiApiKey" placeholder="OpenAI API Key" onchange="validateApiKey('openai')">
                        </div>
                        <select id="openaiModel">
                            <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                            <option value="gpt-4">GPT-4</option>
                            <option value="gpt-4-turbo">GPT-4 Turbo</option>
                        </select>
                        <small>Best for: Professional content, versatile</small>
                    </div>

                    <div class="ai-model-config">
                        <h4>Anthropic Claude <span id="claudeStatus" class="model-status disconnected">Disconnected</span></h4>
                        <div class="form-group">
                            <input type="password" id="claudeApiKey" placeholder="Claude API Key" onchange="validateApiKey('claude')">
                        </div>
                        <select id="claudeModel">
                            <option value="claude-3-sonnet-20240229">Claude 3 Sonnet</option>
                            <option value="claude-3-opus-20240229">Claude 3 Opus</option>
                        </select>
                        <small>Best for: Technical content, analysis</small>
                    </div>
                </div>

                <div class="form-group">
                    <label for="preferredModel">Preferred AI Model:</label>
                    <select id="preferredModel">
                        <option value="gemini">Google Gemini</option>
                        <option value="openai">OpenAI GPT</option>
                        <option value="claude">Anthropic Claude</option>
                        <option value="auto">Auto-select best model</option>
                    </select>
                </div>

                <button onclick="testAllModels()" class="secondary">üß™ Test All Models</button>
            </div>
        </div>

        <!-- Templates Tab -->
        <div id="templates" class="tab-content">
            <div class="card">
                <h2>üìù Content Templates</h2>
                
                <div class="grid">
                    <div>
                        <h4>Platform Templates:</h4>
                        <div class="form-group">
                            <select id="templatePlatform" onchange="loadPlatformTemplates()">
                                <option value="twitter">Twitter/X</option>
                                <option value="linkedin">LinkedIn</option>
                                <option value="instagram">Instagram</option>
                                <option value="facebook">Facebook</option>
                                <option value="tiktok">TikTok</option>
                                <option value="blog">Blog</option>
                            </select>
                        </div>
                        <div id="platformTemplates"></div>
                    </div>
                    
                    <div>
                        <h4>Create Custom Template:</h4>
                        <div class="form-group">
                            <input type="text" id="templateName" placeholder="Template name">
                        </div>
                        <div class="form-group">
                            <textarea id="templateContent" rows="6" placeholder="Template content with placeholders like {repo_name}, {description}, {changes}..."></textarea>
                        </div>
                        <button onclick="saveTemplate()" class="success">üíæ Save Template</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let monitoringInterval;
        let lastCommitSha = null;
        let isMonitoring = false;
        let currentContent = '';
        let platformLimits = {
            twitter: 280,
            linkedin: 3000,
            instagram: 2200,
            facebook: 63206,
            tiktok: 4000,
            blog: Infinity
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedData();
            updatePlatformSettings();
            loadPlatformTemplates();
        });

        // Tab management
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // Creation mode management
        function toggleCreationMode() {
            const mode = document.getElementById('creationMode').value;
            document.getElementById('generateMode').style.display = mode === 'generate' ? 'block' : 'none';
            document.getElementById('rephraseMode').style.display = mode === 'rephrase' ? 'block' : 'none';
            document.getElementById('manualMode').style.display = mode === 'manual' ? 'block' : 'none';
        }

        // Platform settings management
        function updatePlatformSettings() {
            const platform = document.getElementById('targetPlatform').value;
            const limit = platformLimits[platform];
            
            // Update character counter
            updateCharacterCount();
            
            // Update preview styling
            const preview = document.getElementById('platformPreview');
            if (preview) {
                preview.className = `social-preview ${platform}`;
            }
        }

        // Character count management
        function updateCharacterCount() {
            const platform = document.getElementById('targetPlatform').value;
            const content = document.getElementById('contentEditor')?.value || '';
            const limit = platformLimits[platform];
            const count = content.length;
            
            const counterElement = document.getElementById('characterCount');
            if (counterElement) {
                counterElement.textContent = limit === Infinity ? 
                    `${count} characters` : 
                    `${count}/${limit} characters`;
                
                counterElement.className = 'character-count';
                if (limit !== Infinity) {
                    if (count > limit * 0.9) counterElement.classList.add('warning');
                    if (count > limit) counterElement.classList.add('danger');
                }
            }
        }

        // AI Model validation
        async function validateApiKey(provider) {
            const statusElement = document.getElementById(`${provider}Status`);
            const keyElement = document.getElementById(`${provider}ApiKey`);
            
            if (!keyElement.value) {
                statusElement.textContent = 'Disconnected';
                statusElement.className = 'model-status disconnected';
                return;
            }

            statusElement.textContent = 'Testing...';
            statusElement.className = 'model-status';
            
            try {
                const isValid = await testApiKey(provider, keyElement.value);
                statusElement.textContent = isValid ? 'Connected' : 'Invalid';
                statusElement.className = `model-status ${isValid ? 'connected' : 'disconnected'}`;
            } catch (error) {
                statusElement.textContent = 'Error';
                statusElement.className = 'model-status disconnected';
            }
        }

        // API key testing
        async function testApiKey(provider, apiKey) {
            try {
                switch (provider) {
                    case 'gemini':
                        const geminiResponse = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                contents: [{ parts: [{ text: "Hello" }] }]
                            })
                        });
                        return geminiResponse.ok;
                    
                    case 'openai':
                        const openaiResponse = await fetch('https://api.openai.com/v1/chat/completions', {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${apiKey}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                model: 'gpt-3.5-turbo',
                                messages: [{ role: 'user', content: 'Hello' }],
                                max_tokens: 5
                            })
                        });
                        return openaiResponse.ok;
                    
                    case 'claude':
                        const claudeResponse = await fetch('https://api.anthropic.com/v1/messages', {
                            method: 'POST',
                            headers: {
                                'x-api-key': apiKey,
                                'Content-Type': 'application/json',
                                'anthropic-version': '2023-06-01'
                            },
                            body: JSON.stringify({
                                model: 'claude-3-sonnet-20240229',
                                max_tokens: 5,
                                messages: [{ role: 'user', content: 'Hello' }]
                            })
                        });
                        return claudeResponse.ok;
                }
            } catch (error) {
                return false;
            }
            return false;
        }

        // Content generation
        async function generateContent() {
            const mode = document.getElementById('creationMode').value;
            const platform = document.getElementById('targetPlatform').value;
            const tone = document.getElementById('contentTone').value;
            
            log('Generating content...', 'info');
            
            try {
                let content = '';
                
                switch (mode) {
                    case 'generate':
                        content = await generateFromRepo(platform, tone);
                        break;
                    case 'rephrase':
                        content = await rephraseContent(platform, tone);
                        break;
                    case 'manual':
                        content = document.getElementById('manualContent').value;
                        break;
                }
                
                displayContent(content, platform);
                log('Content generated successfully!', 'success');
                
            } catch (error) {
                log(`Error generating content: ${error.message}`, 'error');
                showMessage(error.message, 'error');
            }
        }

        // Generate content from repository
        async function generateFromRepo(platform, tone) {
            const repoUrl = document.getElementById('repoUrl').value;
            const githubToken = document.getElementById('githubToken').value;
            const customPrompt = document.getElementById('generatePrompt').value;
            
            if (!repoUrl || !githubToken) {
                throw new Error('Please configure repository URL and GitHub token');
            }

            const repoInfo = await getRepositoryInfo(repoUrl, githubToken);
            const readmeContent = await getReadmeContent(repoInfo.owner, repoInfo.repo, githubToken);
            
            return await generateWithAI(repoInfo, readmeContent, platform, tone, customPrompt);
        }

        // Rephrase existing content
        async function rephraseContent(platform, tone) {
            const originalText = document.getElementById('originalText').value;
            const instructions = document.getElementById('rephraseInstructions').value;
            
            if (!originalText) {
                throw new Error('Please provide original text to rephrase');
            }

            return await rephraseWithAI(originalText, platform, tone, instructions);
        }

        // Generate with AI using preferred model
        async function generateWithAI(repoInfo, readmeContent, platform, tone, customPrompt) {
            const preferredModel = document.getElementById('preferredModel').value;
            
            const platformPrompts = {
                twitter: `Create a Twitter/X post (max 280 chars) that's ${tone} and engaging`,
                linkedin: `Write a LinkedIn post (max 3000 chars) that's ${tone} and professional`,
                instagram: `Create an Instagram caption (max 2200 chars) that's ${tone} and visually engaging`,
                facebook: `Write a Facebook post that's ${tone} and encourages engagement`,
                tiktok: `Create TikTok caption/description that's ${tone} and trendy`,
                blog: `Write a blog post that's ${tone} and comprehensive`
            };

            const prompt = `${platformPrompts[platform] || platformPrompts.blog}

Repository: ${repoInfo.data.name}
Description: ${repoInfo.data.description || 'No description available'}
Latest commit: ${repoInfo.latestCommit.commit.message}
Commit author: ${repoInfo.latestCommit.commit.author.name}
Language: ${repoInfo.data.language || 'Not specified'}
Stars: ${repoInfo.data.stargazers_count}

${readmeContent ? `README content:\n${readmeContent.substring(0, 1500)}...` : ''}

${customPrompt ? `Additional instructions: ${customPrompt}` : ''}

Platform-specific requirements:
- For Twitter: Include relevant hashtags, keep it concise, use emojis
- For LinkedIn: Professional tone, include call-to-action, longer form acceptable
- For Instagram: Visual language, story-telling, emoji usage, hashtags
- For Facebook: Conversational, encourage comments and shares
- For TikTok: Trendy language, challenge/trend references if relevant
- For Blog: Comprehensive, well-structured, detailed explanations

Generate engaging content that highlights the key features and updates.`;

            return await callAI(preferredModel, prompt);
        }

        // Rephrase with AI
        async function rephraseWithAI(originalText, platform, tone, instructions) {
            const preferredModel = document.getElementById('preferredModel').value;
            
            const limit = platformLimits[platform];
            const limitText = limit === Infinity ? '' : ` (max ${limit} characters)`;
            
            const prompt = `Rephrase this content for ${platform}${limitText} with a ${tone} tone:

Original text: "${originalText}"

${instructions ? `Special instructions: ${instructions}` : ''}

Platform requirements:
- For Twitter: Concise, hashtags, emojis, engaging
- For LinkedIn: Professional, detailed, call-to-action
- For Instagram: Visual storytelling, emojis, hashtags
- For Facebook: Conversational, engaging questions
- For TikTok: Trendy, energetic, current slang
- For Blog: Comprehensive, well-structured, detailed

Make it native to the platform while maintaining the core message.`;

            return await callAI(preferredModel, prompt);
        }

        // Call AI with fallback logic
        async function callAI(preferredModel, prompt) {
            const models = preferredModel === 'auto' ? ['gemini', 'openai', 'claude'] : [preferredModel];
            
            for (const model of models) {
                try {
                    const apiKey = document.getElementById(`${model}ApiKey`).value;
                    if (!apiKey) continue;

                    switch (model) {
                        case 'gemini':
                            return await callGemini(apiKey, prompt);
                        case 'openai':
                            return await callOpenAI(apiKey, prompt);
                        case 'claude':
                            return await callClaude(apiKey, prompt);
                    }
                } catch (error) {
                    log(`${model} failed: ${error.message}`, 'error');
                    continue;
                }
            }
            
            throw new Error('All AI models failed or no API keys configured');
        }

        // AI API calls
        async function callGemini(apiKey, prompt) {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: prompt }] }]
                })
            });

            if (!response.ok) throw new Error(`Gemini API error: ${response.status}`);
            
            const data = await response.json();
            return data.candidates[0].content.parts[0].text;
        }

        async function callOpenAI(apiKey, prompt) {
            const model = document.getElementById('openaiModel').value;
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: model,
                    messages: [{ role: 'user', content: prompt }],
                    max_tokens: 1000
                })
            });

            if (!response.ok) throw new Error(`OpenAI API error: ${response.status}`);
            
            const data = await response.json();
            return data.choices[0].message.content;
        }

        async function callClaude(apiKey, prompt) {
            const model = document.getElementById('claudeModel').value;
            const response = await fetch('https://api.anthropic.com/v1/messages', {
                method: 'POST',
                headers: {
                    'x-api-key': apiKey,
                    'Content-Type': 'application/json',
                    'anthropic-version': '2023-06-01'
                },
                body: JSON.stringify({
                    model: model,
                    max_tokens: 1000,
                    messages: [{ role: 'user', content: prompt }]
                })
            });

            if (!response.ok) throw new Error(`Claude API error: ${response.status}`);
            
            const data = await response.json();
            return data.content[0].text;
        }

        // Display generated content
        function displayContent(content, platform) {
            currentContent = content;
            document.getElementById('contentEditor').value = content;
            document.getElementById('contentPreviewCard').style.display = 'block';
            
            updatePreview();
            generateHashtagSuggestions(content, platform);
            generateAISuggestions(content);
            
            // Scroll to preview
            document.getElementById('contentPreviewCard').scrollIntoView({ behavior: 'smooth' });
        }

        // Update preview
        function updatePreview() {
            const content = document.getElementById('contentEditor').value;
            const platform = document.getElementById('targetPlatform').value;
            const preview = document.getElementById('platformPreview');
            
            currentContent = content;
            updateCharacterCount();
            
            // Create platform-specific preview
            let previewHTML = '';
            switch (platform) {
                case 'twitter':
                    previewHTML = `
                        <div style="border-left: 3px solid #1da1f2; padding-left: 12px;">
                            <strong>@YourHandle</strong> <span style="color: #666;">¬∑ now</span>
                            <div style="margin-top: 8px; line-height: 1.4;">${content.replace(/\n/g, '<br>')}</div>
                        </div>
                    `;
                    break;
                case 'linkedin':
                    previewHTML = `
                        <div style="border: 1px solid #e6e6e6; border-radius: 8px; padding: 12px; background: white;">
                            <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                <div style="width: 32px; height: 32px; background: #0077b5; border-radius: 50%; margin-right: 8px;"></div>
                                <div>
                                    <strong>Your Name</strong><br>
                                    <small style="color: #666;">Your Title</small>
                                </div>
                            </div>
                            <div style="line-height: 1.5;">${content.replace(/\n/g, '<br>')}</div>
                        </div>
                    `;
                    break;
                case 'instagram':
                    previewHTML = `
                        <div style="border: 1px solid #dbdbdb; border-radius: 8px; background: white;">
                            <div style="aspect-ratio: 1; background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); margin-bottom: 8px;"></div>
                            <div style="padding: 12px;">
                                <strong>@yourhandle</strong> ${content.replace(/\n/g, '<br>')}
                            </div>
                        </div>
                    `;
                    break;
                default:
                    previewHTML = `<div style="padding: 12px; line-height: 1.5;">${content.replace(/\n/g, '<br>')}</div>`;
            }
            
            preview.innerHTML = previewHTML;
            preview.className = `social-preview ${platform}`;
        }

        // Generate hashtag suggestions
        function generateHashtagSuggestions(content, platform) {
            const commonTags = {
                twitter: ['#coding', '#github', '#opensource', '#developer', '#tech', '#programming'],
                linkedin: ['#technology', '#development', '#innovation', '#coding', '#github', '#opensource'],
                instagram: ['#code', '#programming', '#developer', '#tech', '#coding', '#github'],
                facebook: ['#coding', '#technology', '#development', '#opensource'],
                tiktok: ['#coding', '#tech', '#programming', '#developer', '#github', '#fyp'],
                blog: ['development', 'programming', 'technology', 'open source']
            };

            const tags = commonTags[platform] || commonTags.twitter;
            const container = document.getElementById('hashtagSuggestions');
            
            container.innerHTML = tags.map(tag => 
                `<span class="hashtag" onclick="insertHashtag('${tag}')">${tag}</span>`
            ).join('');
        }

        // Generate AI suggestions
        async function generateAISuggestions(content) {
            const suggestions = [
                "Try adding more emojis for engagement",
                "Consider shortening for better readability",
                "Add a call-to-action",
                "Include relevant hashtags",
                "Make it more conversational"
            ];
            
            document.getElementById('aiSuggestions').innerHTML = 
                suggestions.map(s => `<div>‚Ä¢ ${s}</div>`).join('');
        }

        // Insert emoji
        function insertEmoji(emoji) {
            const editor = document.getElementById('contentEditor');
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            const text = editor.value;
            
            editor.value = text.substring(0, start) + emoji + text.substring(end);
            editor.selectionStart = editor.selectionEnd = start + emoji.length;
            editor.focus();
            
            updatePreview();
        }

        // Insert hashtag
        function insertHashtag(hashtag) {
            const editor = document.getElementById('contentEditor');
            editor.value += ' ' + hashtag;
            editor.focus();
            updatePreview();
        }

        // Copy content
        function copyContent() {
            const content = document.getElementById('contentEditor').value;
            navigator.clipboard.writeText(content).then(() => {
                showMessage('Content copied to clipboard!', 'success');
            });
        }

        // Download content
        function downloadContent() {
            const content = document.getElementById('contentEditor').value;
            const platform = document.getElementById('targetPlatform').value;
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${platform}-post-${new Date().getTime()}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            showMessage('Content downloaded!', 'success');
        }

        // Schedule post (placeholder)
        function schedulePost() {
            showMessage('Scheduling feature coming soon!', 'info');
        }

        // Refine content with AI
        async function refineContent() {
            const content = document.getElementById('contentEditor').value;
            const platform = document.getElementById('targetPlatform').value;
            
            try {
                log('Refining content with AI...', 'info');
                const refinedContent = await rephraseWithAI(content, platform, 'engaging', 'Make it more engaging and platform-optimized');
                document.getElementById('contentEditor').value = refinedContent;
                updatePreview();
                log('Content refined successfully!', 'success');
            } catch (error) {
                log(`Error refining content: ${error.message}`, 'error');
                showMessage(error.message, 'error');
            }
        }

        // Test all AI models
        async function testAllModels() {
            const models = ['gemini', 'openai', 'claude'];
            
            for (const model of models) {
                const apiKey = document.getElementById(`${model}ApiKey`).value;
                if (apiKey) {
                    await validateApiKey(model);
                }
            }
            
            showMessage('AI model testing completed', 'info');
        }

        // Template management
        function loadPlatformTemplates() {
            const platform = document.getElementById('templatePlatform').value;
            const templates = getTemplates(platform);
            const container = document.getElementById('platformTemplates');
            
            container.innerHTML = templates.map(template => `
                <div style="border: 1px solid #ddd; border-radius: 4px; padding: 10px; margin: 5px 0;">
                    <strong>${template.name}</strong>
                    <p style="font-size: 12px; color: #666; margin: 5px 0;">${template.content}</p>
                    <button onclick="useTemplate('${template.content}')" class="secondary" style="font-size: 12px; padding: 4px 8px;">Use</button>
                </div>
            `).join('');
        }

        // Get default templates
        function getTemplates(platform) {
            const templates = {
                twitter: [
                    { name: "New Release", content: "üöÄ Just released {repo_name} v{version}! {description} Check it out: {url} #opensource #coding" },
                    { name: "Feature Update", content: "‚ú® New feature in {repo_name}: {feature_description} What do you think? {url} #development" }
                ],
                linkedin: [
                    { name: "Professional Update", content: "Excited to share the latest updates to {repo_name}. This project focuses on {description} and has reached {stars} stars. Key improvements include: {changes}" },
                    { name: "Technical Deep Dive", content: "Technical breakdown of {repo_name}: Built with {language}, this project solves {problem}. Latest updates: {changes}" }
                ],
                instagram: [
                    { name: "Visual Story", content: "üíª Behind the code: {repo_name} ‚ú®\n\n{description}\n\nSwipe to see the journey! ‚û°Ô∏è\n\n#coding #developer #tech #github" },
                    { name: "Achievement Post", content: "üéâ Milestone alert! {repo_name} just hit {stars} stars! üåü\n\nThank you to everyone who supported this {language} project. More updates coming soon! üí™\n\n#grateful #opensource #coding" }
                ]
            };
            
            return templates[platform] || [];
        }

        // Use template
        function useTemplate(template) {
            document.getElementById('templateContent').value = template;
            showMessage('Template loaded! You can customize it before saving.', 'info');
        }

        // Save custom template
        function saveTemplate() {
            const name = document.getElementById('templateName').value;
            const content = document.getElementById('templateContent').value;
            
            if (!name || !content) {
                showMessage('Please provide both template name and content', 'error');
                return;
            }
            
            // Save to localStorage (in a real app, this would go to a database)
            const templates = JSON.parse(localStorage.getItem('customTemplates') || '{}');
            const platform = document.getElementById('templatePlatform').value;
            
            if (!templates[platform]) templates[platform] = [];
            templates[platform].push({ name, content });
            
            localStorage.setItem('customTemplates', JSON.stringify(templates));
            
            showMessage('Template saved successfully!', 'success');
            loadPlatformTemplates();
            
            // Clear form
            document.getElementById('templateName').value = '';
            document.getElementById('templateContent').value = '';
        }

        // Monitoring functions (unchanged from previous version)
        function log(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function updateStatus(text, isActive = false) {
            document.getElementById('statusText').textContent = text;
            document.getElementById('statusIndicator').classList.toggle('active', isActive);
        }

        function showMessage(message, type = 'info') {
            const statusMessage = document.getElementById('statusMessage');
            statusMessage.className = `status ${type}`;
            statusMessage.textContent = message;
            statusMessage.style.display = 'block';
            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 5000);
        }

        async function fetchFromGitHub(endpoint, token) {
            const response = await fetch(`https://api.github.com${endpoint}`, {
                headers: {
                    'Authorization': `token ${token}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            });

            if (!response.ok) {
                throw new Error(`GitHub API error: ${response.status} ${response.statusText}`);
            }

            return await response.json();
        }

        async function getRepositoryInfo(repoUrl, token) {
            const match = repoUrl.match(/github\.com\/([^\/]+)\/([^\/]+)/);
            if (!match) {
                throw new Error('Invalid GitHub repository URL');
            }

            const [, owner, repo] = match;
            const cleanRepo = repo.replace('.git', '');

            try {
                const repoData = await fetchFromGitHub(`/repos/${owner}/${cleanRepo}`, token);
                const commits = await fetchFromGitHub(`/repos/${owner}/${cleanRepo}/commits?per_page=1`, token);
                
                return {
                    owner,
                    repo: cleanRepo,
                    data: repoData,
                    latestCommit: commits[0]
                };
            } catch (error) {
                throw new Error(`Failed to fetch repository info: ${error.message}`);
            }
        }

        async function getReadmeContent(owner, repo, token) {
            try {
                const readme = await fetchFromGitHub(`/repos/${owner}/${repo}/readme`, token);
                const content = atob(readme.content);
                return content;
            } catch (error) {
                log(`Could not fetch README: ${error.message}`, 'error');
                return null;
            }
        }

        async function checkForChanges() {
            const githubToken = document.getElementById('githubToken').value;
            const repoUrl = document.getElementById('repoUrl').value;
            const autoGenerate = document.getElementById('autoGenerate').checked;

            if (!githubToken || !repoUrl) {
                showMessage('Please configure GitHub token and repository URL', 'error');
                return;
            }

            try {
                log('Checking for repository changes...');
                const repoInfo = await getRepositoryInfo(repoUrl, githubToken);
                
                // Update repository info display
                document.getElementById('repoInfo').innerHTML = `
                    <p><strong>Repository:</strong> ${repoInfo.data.full_name}</p>
                    <p><strong>Description:</strong> ${repoInfo.data.description || 'No description'}</p>
                    <p><strong>Stars:</strong> ${repoInfo.data.stargazers_count}</p>
                    <p><strong>Language:</strong> ${repoInfo.data.language || 'Not specified'}</p>
                    <p><strong>Last updated:</strong> ${new Date(repoInfo.data.updated_at).toLocaleString()}</p>
                `;

                const currentCommitSha = repoInfo.latestCommit.sha;
                
                if (lastCommitSha === null) {
                    lastCommitSha = currentCommitSha;
                    log(`Initial commit SHA recorded: ${currentCommitSha.substring(0, 7)}`);
                } else if (lastCommitSha !== currentCommitSha) {
                    log(`New commit detected: ${currentCommitSha.substring(0, 7)}`, 'success');
                    log(`Commit message: ${repoInfo.latestCommit.commit.message}`);
                    
                    if (autoGenerate) {
                        const platforms = Array.from(document.getElementById('selectedPlatforms').selectedOptions).map(o => o.value);
                        
                        for (const platform of platforms) {
                            log(`Generating ${platform} post...`);
                            const content = await generateFromRepo(platform, 'professional');
                            // In a real app, you might save these or send them somewhere
                            log(`${platform} post generated successfully`, 'success');
                        }
                    }
                    
                    lastCommitSha = currentCommitSha;
                } else {
                    log('No new changes detected');
                }
            } catch (error) {
                log(`Error: ${error.message}`, 'error');
                showMessage(error.message, 'error');
            }
        }

        function startMonitoring() {
            if (isMonitoring) return;
            
            const interval = parseInt(document.getElementById('checkInterval').value) * 60000;
            
            checkForChanges(); // Initial check
            monitoringInterval = setInterval(checkForChanges, interval);
            
            isMonitoring = true;
            updateStatus('Monitoring Active', true);
            log(`Monitoring started. Checking every ${interval/60000} minutes.`, 'success');
            showMessage('Monitoring started successfully', 'success');
        }

        function stopMonitoring() {
            if (!isMonitoring) return;
            
            clearInterval(monitoringInterval);
            isMonitoring = false;
            updateStatus('Stopped', false);
            log('Monitoring stopped.', 'info');
            showMessage('Monitoring stopped', 'info');
        }

        function checkNow() {
            log('Manual check initiated...');
            checkForChanges();
        }

        // Load and save data
        function loadSavedData() {
            const saved = localStorage.getItem('githubMonitorConfig');
            if (saved) {
                const config = JSON.parse(saved);
                Object.keys(config).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) element.value = config[key];
                });
            }
        }

        function saveData() {
            const config = {
                githubToken: document.getElementById('githubToken').value,
                repoUrl: document.getElementById('repoUrl').value,
                geminiApiKey: document.getElementById('geminiApiKey').value,
                openaiApiKey: document.getElementById('openaiApiKey').value,
                claudeApiKey: document.getElementById('claudeApiKey').value
            };
            localStorage.setItem('githubMonitorConfig', JSON.stringify(config));
        }

        // Auto-save on input change
        document.addEventListener('input', saveData);

        // Initialize
        log('AI-Powered Social Media Generator initialized', 'success');
    </script>
</body>
</html>